# 法律领域实体类型说明

本文档详细说明了 DynHyperRAG 系统在处理 CAIL2019 法律数据集时使用的实体类型分类法。

## 概述

CAIL2019（China AI and Law 2019）是中国法律人工智能挑战赛的数据集，包含大量中文法律案例。为了有效地进行知识图谱构建和检索，我们定义了六种核心法律实体类型。

## 实体类型定义

### 1. 法律法规 (law)

**定义**: 法律条文、法规、规章制度等法律文件

**包含内容**:
- 基本法律：刑法、民法、行政法、商法等
- 专门法律：合同法、物权法、公司法、证券法等
- 程序法：民事诉讼法、刑事诉讼法、行政诉讼法等
- 法规条例：实施细则、管理办法、指导意见等

**关键词示例**:
```
刑法, 民法, 合同法, 公司法, 民事诉讼法, 行政处罚法
法律, 法规, 条例, 规定, 办法, 细则, 准则
```

### 2. 法条 (article)

**定义**: 法律条文中的具体条款、款项和规定

**包含内容**:
- 具体条文：第XX条、第XX款、第XX项
- 条款引用：前款、本款、相关条款
- 法条适用：依据、根据、按照、参照

**关键词示例**:
```
第.*条, 条款, 款项, 第一条, 第二条, 前款, 本款
依据, 根据, 按照, 参照, 适用, 违反, 触犯
```

### 3. 法院机构 (court)

**定义**: 司法机关、法院、法庭等司法机构

**包含内容**:
- 法院层级：最高法院、高级法院、中级法院、基层法院
- 专门法院：军事法院、海事法院、知识产权法院
- 司法机关：检察院、公安机关、仲裁委员会
- 法庭组织：审判庭、合议庭、执行局

**关键词示例**:
```
最高人民法院, 中级人民法院, 基层人民法院
人民检察院, 公安机关, 仲裁委员会
审判庭, 合议庭, 执行局, 立案庭
```

### 4. 当事人 (party)

**定义**: 法律程序中涉及的各方当事人和参与者

**包含内容**:
- 民事当事人：原告、被告、第三人
- 刑事当事人：被告人、被害人、证人
- 程序参与人：代理人、辩护人、鉴定人
- 其他相关人：债权人、债务人、担保人

**关键词示例**:
```
原告, 被告, 第三人, 被告人, 被害人, 证人
法定代理人, 委托代理人, 辩护人, 诉讼代表人
债权人, 债务人, 担保人, 利害关系人
```

### 5. 罪名 (crime)

**定义**: 刑事犯罪的罪名、违法行为类型

**包含内容**:
- 暴力犯罪：故意杀人罪、故意伤害罪、抢劫罪
- 财产犯罪：盗窃罪、诈骗罪、敲诈勒索罪
- 经济犯罪：合同诈骗罪、集资诈骗罪、非法经营罪
- 职务犯罪：贪污罪、受贿罪、挪用公款罪
- 其他犯罪：危险驾驶罪、妨害公务罪、寻衅滋事罪

**关键词示例**:
```
故意杀人罪, 故意伤害罪, 盗窃罪, 诈骗罪, 抢劫罪
贪污罪, 受贿罪, 合同诈骗罪, 危险驾驶罪
犯罪, 罪名, 罪行, 违法行为, 刑事犯罪
```

### 6. 刑罚 (penalty)

**定义**: 法律制裁、刑罚措施和民事责任

**包含内容**:
- 主刑：死刑、无期徒刑、有期徒刑、拘役、管制、罚金
- 附加刑：剥夺政治权利、没收财产、驱逐出境
- 刑罚执行：缓刑、假释、减刑、社区矫正
- 民事责任：赔偿、补偿、违约金、损害赔偿

**关键词示例**:
```
死刑, 无期徒刑, 有期徒刑, 拘役, 管制, 罚金
剥夺政治权利, 没收财产, 缓刑, 假释, 减刑
赔偿, 补偿, 违约金, 损害赔偿, 精神损害赔偿
```

## 实体类型识别

### 识别算法

系统使用基于关键词匹配和正则表达式的方法识别实体类型：

1. **关键词匹配**: 对每种实体类型维护关键词词典
2. **正则表达式**: 处理模式化表达（如"第XX条"）
3. **置信度计算**: 基于匹配数量和优先级计算置信度
4. **消歧策略**: 使用优先级解决多类型冲突

### 优先级设置

当文本匹配多种实体类型时，按以下优先级排序：

1. **law** (法律法规) - 优先级最高
2. **article** (法条) - 次之
3. **crime** (罪名)
4. **penalty** (刑罚)
5. **court** (法院机构)
6. **party** (当事人) - 优先级最低

### 使用示例

```python
from hypergraphrag.data.legal_entity_types import get_legal_taxonomy

# 创建分类器实例
taxonomy = get_legal_taxonomy()

# 识别实体类型
text = "根据《刑法》第二百三十二条规定，故意杀人的，处死刑、无期徒刑"
scores = taxonomy.identify_entity_types(text)
primary_type = taxonomy.get_primary_entity_type(text)

print(f"主要实体类型: {primary_type}")  # 输出: law
print(f"所有类型分数: {scores}")
```

## 配置说明

### 环境变量配置

可以通过环境变量自定义法律领域的实体类型：

```bash
# 自定义法律实体类型（逗号分隔）
export ENTITY_TYPES_LEGAL="law,article,court,party,crime,penalty,contract,evidence"

# 设置检索域为法律领域
export RETRIEVAL_DOMAIN="legal"
```

### 配置文件设置

在 `config.py` 中的相关配置：

```python
# 实体过滤配置
self.entity_filter_enabled = True
self.domain = "legal"  # 使用法律领域
self.entity_taxonomy = {
    "legal": ["law", "article", "court", "party", "crime", "penalty"]
}
```

## 数据集适配

### CAIL2019 数据格式

CAIL2019 数据集包含多种任务类型：

- **阅读理解任务**: 基于法律条文的问答
- **案例分析**: 法律案例的事实描述和判决
- **法条检索**: 相关法条的匹配和推荐

### 实体抽取流程

1. **文本预处理**: 清洗和规范化法律文本
2. **实体识别**: 使用关键词和模式匹配识别实体
3. **类型分类**: 为每个实体分配最合适的类型
4. **质量评估**: 评估实体抽取的质量和一致性
5. **图谱构建**: 将实体和关系构建为超图结构

## 扩展指南

### 添加新实体类型

1. 在 `ENTITY_TYPES` 中添加新类型
2. 在 `ENTITY_DEFINITIONS` 中添加定义
3. 在 `ENTITY_KEYWORDS` 中添加关键词
4. 在 `ENTITY_PRIORITY` 中设置优先级
5. 更新配置文件中的分类法

### 优化关键词词典

1. **收集语料**: 从实际法律文档中收集术语
2. **频率分析**: 统计关键词出现频率
3. **专家验证**: 请法律专家验证术语准确性
4. **迭代优化**: 根据识别效果调整关键词

## 性能指标

### 评估指标

- **准确率**: 正确识别的实体类型比例
- **召回率**: 识别出的实体占总实体的比例
- **F1分数**: 准确率和召回率的调和平均
- **覆盖率**: 关键词词典的覆盖范围

### 基准测试

在 CAIL2019 测试集上的性能表现：

| 实体类型 | 准确率 | 召回率 | F1分数 |
|---------|--------|--------|--------|
| law     | 0.92   | 0.88   | 0.90   |
| article | 0.89   | 0.85   | 0.87   |
| court   | 0.86   | 0.82   | 0.84   |
| party   | 0.83   | 0.79   | 0.81   |
| crime   | 0.91   | 0.87   | 0.89   |
| penalty | 0.88   | 0.84   | 0.86   |

*注：以上数据为示例，实际性能需要通过实验验证*

## 相关文件

- `hypergraphrag/data/legal_entity_types.py` - 实体类型定义和识别算法
- `hypergraphrag/data/cail2019_loader.py` - CAIL2019 数据加载器
- `config.py` - 系统配置文件
- `hypergraphrag/retrieval/entity_filter.py` - 实体类型过滤器

## 参考资料

1. [CAIL2019 竞赛官网](http://cail.cipsc.org.cn/)
2. [中华人民共和国法律法规数据库](http://www.npc.gov.cn/)
3. [最高人民法院网](http://www.court.gov.cn/)
4. [中国法律服务网](https://www.12348.gov.cn/)